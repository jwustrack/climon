<html>
<head>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.1/css/materialize.min.css">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>
<body>
<script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.1/js/materialize.min.js"></script>
<script src="/static/Chart.bundle.js"></script>

<div class="container">
<header>
<h4>climon</h4>
<div class="row">
<div class="col s12">
<ul class="tabs">
	<li class="tab col s3"><a href="#day">Day</a></li>
	<li class="tab col s3"><a href="#week">Week</a></li>
	<li class="tab col s3"><a href="#month">Month</a></li>
	<li class="tab col s3"><a href="#all">All</a></li>
</ul>
</div>
</div>
</header>
<div id="day" class="col s12">
</div>
<div id="week" class="col s12">
</div>
<div id="month" class="col s12">
</div>
<div id="all" class="col s12">
</div>
<main>
<div class="card-panel">
<h5>Temperature</h5>
<div style="height: 200px;">
<canvas id="tempChart" style="height: 200px"></canvas>
</div>
</div>
<div class="card-panel">
<h5>Humidity</h5>
<div style="height: 200px;">
<canvas id="humChart" style="height: 200px"></canvas>
</div>
</div>
<script>
colors = {
{% for sensor_id, sensor_conf in sensor_confs.items() %}
'{{ sensor_id }}': "{{ sensor_conf['color'] }}",
{% endfor %}
};
labels = {
{% for sensor_id, sensor_conf in sensor_confs.items() %}
'{{ sensor_id }}': "{{ sensor_conf['name'] }}",
{% endfor %}
};
humData=[];
tempData=[];
for (var key in colors)
{
    tempData.push(
        {
            label: labels[key],
            pointRadius: 0,
            borderWidth: 2,
            data: [],
            backgroundColor: "rgba(0,0,0,0)",
            borderColor: colors[key],
            key: key,
        }
    );
    humData.push(
        {
            label: labels[key],
            pointRadius: 0,
            borderWidth: 2,
            data: [],
            backgroundColor: "rgba(0,0,0,0)",
            borderColor: colors[key],
            key: key,
        }
    );
}
var ctx = $("#tempChart");
window.myTempChart = new Chart(ctx, {
    type: 'line',
    data: {
        datasets: tempData
    },
    options: {
        scales: {
            xAxes: [{
                type: 'time',
                position: 'bottom'
            }],
        },
	responsive: true,
	maintainAspectRatio: false,
	animation: false
    }
});
var ctx = $("#humChart");
window.myHumChart = new Chart(ctx, {
    type: 'line',
    data: {
        datasets: humData
    },
    options: {
        scales: {
            xAxes: [{
                type: 'time',
                position: 'bottom'
            }],
        },
	responsive: true,
	maintainAspectRatio: false,
	animation: false
    }
});
function showGraph(range) {
	location.hash = '#' + range;
	window.myTempChart.data.datasets.forEach((dataset) => {
		dataset.data = [];
	});
	window.myHumChart.data.datasets.forEach((dataset) => {
		dataset.data = [];
	});
	$.getJSON( "/data/" + range + "/{{date}}", function( data ) {
		for (var key in data)
		{
		window.myTempChart.data.datasets.forEach((dataset) => {
		    if (dataset.key == key) {
			dataset.data = data[key]['temperatures'];
		    }
		});
		window.myHumChart.data.datasets.forEach((dataset) => {
		    if (dataset.key == key) {
			dataset.data = data[key]['humidities'];
		    }
		});
		    window.myTempChart.update();
		    window.myHumChart.update();
		}
	});
}
if (window.location.hash) {
    showGraph(window.location.hash.substring(1));
} else {
    showGraph('day');
}
</script>
<script>
$(document).ready(function() { 
$("ul.tabs").tabs({ onShow: function(tab) {
	showGraph(tab.attr('id'));
} });
})
</script>
</main>
</div>
</body>
</html>
