{% extends "base.html" %}
{% block content %}
<main>
<ul class="collection">
{% for sensor_id, sensor_conf in sensor_confs.items() %}
<li class="collection-item flow-text">
    <label style='color:{{ sensor_conf['color'] }}'>{{ sensor_conf['name'] }}</label><p id="sensor_{{sensor_id}}" style="margin: 0 16px;">...</p>
</li>
{% endfor %}

{% for toggle_id, toggle_conf in toggle_confs.items() %}
<li class="collection-item flow-text">
  <div class="switch">
    <label style='color:{{ toggle_conf['color'] }}'>
      {{ toggle_conf['name'] }}
      <input type="checkbox" id="{{toggle_id}}" onchange="toggle(this)">
      <span class="lever"></span>
    </label>
  </div>
</li>
{% endfor %}
</ul>

</main>
<script>
function toggle(element) {
    $.getJSON( "/data/toggle/" + element.id + "/" + element.checked,
            function( resp ) {
                element.checked = resp;
            });
}
function setCurrentTemp () {
    $.getJSON( "/data/now", function( resp ) {
        var s = "";
        for (var sensor_id in resp['sensors'])
        {
            $("#sensor_" + sensor_id)[0].innerHTML = "" +
                Math.round(10*resp['sensors'][sensor_id]["temperature"])/10 + "Â°C " +
                Math.round(10*resp['sensors'][sensor_id]["humidity"])/10 + "%";
        }
        setTimeout(setCurrentTemp, 1*1000);
    });
}
$(document).ready(function() {
setCurrentTemp();
{% for toggle_id in toggle_confs.keys() %}
$.getJSON( "/data/toggle/{{toggle_id}}",
    function( resp ) {
	$("#{{toggle_id}}")[0].checked = resp;
    });
{% endfor %}
})
</script>
{% endblock content %}
