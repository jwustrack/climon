{% extends "base.html" %}
{% block content %}
{% for group, elements in conf.groups %}
    <h5 style='color:{{group['color']}}'>{{ group['name'] }}</h5>
    <div class='row'>
    {% for element_id, element in elements %}
        <div class='col s12 m6 l4'>
        <p>
        {% if element['element_type'] == 'sensor' %}
        <label>{{ element['name'] }}</label><span id="sensor_{{element['id']}}">...</span>
        {% elif element['element_type'] == 'toggle' %}
          <span>{{ element['name'] }}</span>
            <div class="switch">
              <label>
                  <!--<span>{{ element['name'] }}</span>-->
                <input type="checkbox" id="{{element['id']}}" onchange="toggle(this)">
                <span class="lever"></span>
              </label>
            </div>
        {% endif %}
        </p>
        </div>
    {% endfor %}
    </div>
{% endfor %}

<main>
</main>
<script>
function toggle(element) {
    $.getJSON( "/data/toggle/" + element.id + "/" + element.checked,
            function( resp ) {
                element.checked = resp;
            });
}
function setCurrentTemp () {
    $.getJSON( "/data/now", function( resp ) {
        var s = "";
        for (var sensor_id in resp['sensors'])
        {
            $("#sensor_" + sensor_id)[0].innerHTML = "" +
                Math.round(10*resp['sensors'][sensor_id]["temperature"])/10 + "Â°C " +
                Math.round(10*resp['sensors'][sensor_id]["humidity"])/10 + "%";
        }
        setTimeout(setCurrentTemp, 1*1000);
    });
}
$(document).ready(function() {
setCurrentTemp();
{% for toggle_id in conf.toggles.keys() %}
$.getJSON( "/data/toggle/{{toggle_id}}",
    function( resp ) {
	$("#{{toggle_id}}")[0].checked = resp;
    });
{% endfor %}
})
</script>
{% endblock content %}
